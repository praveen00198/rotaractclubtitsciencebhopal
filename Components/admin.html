<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <style>
      .content-section {
        animation: fadeIn 0.4s ease-in-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body class="bg-gray-100 font-sans">
    <!-- Header -->
    <header
      class="flex justify-between items-center px-6 py-4 bg-white shadow-md"
    >
      <div class="club-logo flex items-center gap-4">
        <img
          src="../Assets/Image/RAC-removebg-preview.png"
          alt="Logo"
          class="w-14"
        />
        <p class="title-logo text-lg md:text-xl font-bold leading-tight">
          Rotaract Club Of <br />
          <span class="text-pink-600">TIT & Science Bhopal, RID3040</span>
        </p>
      </div>

      <div
        class="admin flex items-center gap-2 bg-gray-50 px-4 py-2 rounded-full shadow-sm hover:shadow-md transition"
      >
        <i class="ri-account-circle-line text-2xl text-pink-600"></i>
        <p class="name text-lg font-semibold">Admin</p>
      </div>
    </header>

    <!-- Main Section -->
    <main class="flex h-[calc(100vh-80px)]">
      <!-- Sidebar -->
      <aside
        class="w-72 bg-gradient-to-b from-pink-100 to-white border-r shadow-md flex flex-col justify-between"
      >
        <ul class="mt-6 space-y-2 px-4">
          <li
            class="sidebar-item flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer transition hover:bg-pink-100 active:bg-pink-200"
            data-section="dashboard"
          >
            <i class="ri-line-chart-fill text-pink-600 text-xl"></i>
            <span class="text-base font-medium">Dashboard</span>
          </li>
          <li
            class="sidebar-item flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer transition hover:bg-pink-100"
            data-section="events"
          >
            <i class="ri-calendar-event-fill text-pink-600 text-xl"></i>
            <span class="text-base font-medium">Manage Events</span>
          </li>
          <li
            class="sidebar-item flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer transition hover:bg-pink-100"
            data-section="members"
          >
            <i class="ri-team-line text-pink-600 text-xl"></i>
            <span class="text-base font-medium">Members</span>
          </li>
          <li
            class="sidebar-item flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer transition hover:bg-pink-100"
            data-section="donations"
          >
            <i class="ri-money-rupee-circle-fill text-pink-600 text-xl"></i>
            <span class="text-base font-medium">Donations</span>
          </li>
          <li
            class="sidebar-item flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer transition hover:bg-pink-100"
            data-section="notifications"
          >
            <i class="ri-notification-4-fill text-pink-600 text-xl"></i>
            <span class="text-base font-medium">Notifications</span>
          </li>
        </ul>

        <div class="p-4">
          <button
            class="w-full py-2 bg-pink-600 hover:bg-pink-700 transition text-white rounded-lg font-medium shadow-md"
          >
            Logout
          </button>
        </div>
      </aside>

      <!-- Content -->
      <section class="flex-1 p-8 overflow-y-auto">
        <!-- Dashboard -->
        <div id="dashboard" class="content-section">
          <h1 class="text-3xl font-bold mb-8 text-gray-800">ðŸ“Š Dashboard</h1>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div
              class="bg-white p-6 rounded-2xl shadow-md hover:shadow-lg transition"
            >
              <h2 class="text-gray-500">Total Events</h2>
              <p id="event-count" class="text-3xl font-bold text-pink-600">0</p>
            </div>
            <div
              class="bg-white p-6 rounded-2xl shadow-md hover:shadow-lg transition"
            >
              <h2 class="text-gray-500">Members</h2>
              <p class="text-3xl font-bold text-pink-600">0</p>
            </div>
            <div
              class="bg-white p-6 rounded-2xl shadow-md hover:shadow-lg transition"
            >
              <h2 class="text-gray-500">Donations</h2>
              <p class="text-3xl font-bold text-pink-600">0</p>
            </div>
          </div>
        </div>

        <!-- Manage Events -->
        <!-- Manage Events -->
        <div id="events" class="content-section hidden">
          <h1 class="text-3xl font-bold mb-8 text-gray-800">
            ðŸ“… Manage Events
          </h1>

          <!-- Recent Projects -->
          <div class="bg-white rounded-2xl shadow-lg mb-8">
            <div class="flex justify-between items-center px-6 py-4 border-b">
              <h2 class="text-xl font-semibold text-gray-800">
                Recent Projects
              </h2>
            </div>
            <div class="overflow-x-auto">
              <table class="w-full text-sm">
                <thead>
                  <tr
                    class="bg-gradient-to-r from-pink-500 to-pink-600 text-white text-left"
                  >
                    <th class="p-4">Event Name</th>
                    <th class="p-4">Status</th>
                    <th class="p-4">Date</th>
                    <th class="p-4">Location</th>
                    <th class="p-4">Actions</th>
                  </tr>
                </thead>
                <tbody id="eventTableBody" class="divide-y divide-gray-200">
                  <!-- Dynamic rows will appear here -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- Add Event Form -->
          <div class="bg-white p-6 rounded-2xl shadow-lg">
            <h2 class="text-xl font-semibold text-gray-800 mb-6">
              âž• Add New Event
            </h2>
            <form id="eventForm" class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Event Name</label
                >
                <input
                  type="text"
                  id="eventName"
                  required
                  class="mt-1 w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-pink-500 outline-none"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Description</label
                >
                <textarea
                  id="eventDesc"
                  required
                  rows="3"
                  class="mt-1 w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-pink-500 outline-none"
                ></textarea>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Status</label
                >
                <select
                  id="eventStatus"
                  required
                  class="mt-1 w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-pink-500 outline-none"
                >
                  <option value="Upcoming">Upcoming</option>
                  <option value="Ongoing">Ongoing</option>
                  <option value="Completed">Completed</option>
                </select>
              </div>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700"
                    >Date</label
                  >
                  <input
                    type="date"
                    id="eventDate"
                    required
                    class="mt-1 w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-pink-500 outline-none"
                  />
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700"
                    >Location</label
                  >
                  <input
                    type="text"
                    id="eventLocation"
                    required
                    class="mt-1 w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-pink-500 outline-none"
                  />
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Upload Images</label
                >
                <input
                  type="file"
                  id="eventImages"
                  multiple
                  accept="image/*"
                  class="mt-1 w-full border rounded-lg px-3 py-2"
                />
                <div id="imagePreview" class="mt-3 flex flex-wrap gap-3"></div>
              </div>

              <button
                type="submit"
                class="mt-4 px-6 py-2 bg-pink-600 hover:bg-pink-700 text-white rounded-lg shadow-md"
              >
                Add Event
              </button>
            </form>
          </div>
        </div>

        <!-- Members -->
        <!-- Members / Join Us Section -->
<div id="members" class="content-section hidden">
  <h1 class="text-3xl font-bold mb-8 text-gray-800">ðŸ‘¥ Members / Join Requests</h1>

  <!-- Pending Requests -->
  <div class="bg-white p-6 rounded-xl shadow-md mb-8">
    <p class="font-medium mb-4">Pending Requests</p>
    <ul id="pendingList" class="space-y-3"></ul>
  </div>

  <!-- All Members Table -->
  <div class="bg-white p-6 rounded-xl shadow-md overflow-x-auto">
    <h2 class="text-xl font-semibold mb-4">All Members</h2>
    <table class="w-full text-sm">
      <thead>
        <tr class="bg-gray-100 text-left text-gray-700">
          <th class="p-3">Name</th>
          <th class="p-3">Email</th>
          <th class="p-3">Phone</th>
          <th class="p-3">Status</th>
          <th class="p-3">Timestamp</th>
          <th class="p-3">Actions</th>
        </tr>
      </thead>
      <tbody id="memberTableBody" class="divide-y divide-gray-200">
        <!-- Dynamic rows go here -->
      </tbody>
    </table>
  </div>

  <div class="mt-4">
    <button id="clearAllMembers" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg shadow-md">
      Clear All Members
    </button>
  </div>
</div>


        <!-- Donations -->
        <!-- Donations -->
<div id="donations" class="content-section hidden">
  <h1 class="text-3xl font-bold mb-8 text-gray-800">ðŸ’° Donations</h1>

  <div class="bg-white rounded-xl shadow-md overflow-hidden mb-4">
    <div class="p-4 flex justify-end">
      <button id="clearAllBtn" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg shadow-md">
        Clear All
      </button>
    </div>
    <table class="w-full">
      <thead>
        <tr class="bg-gray-100 text-left text-gray-700">
          <th class="p-3">Donor</th>
          <th class="p-3">Amount</th>
          <th class="p-3">Date</th>
          <th class="p-3">Actions</th>
        </tr>
      </thead>
      <tbody id="donationTableBody">
        <!-- Dynamic CSV rows will appear here -->
      </tbody>
    </table>
  </div>
</div>


        <!-- Notifications -->
        <div id="notifications" class="content-section hidden">
          <h1 class="text-3xl font-bold mb-8 text-gray-800">
            ðŸ”” Notifications
          </h1>
          <ul class="space-y-4">
            <li
              class="bg-white p-4 rounded-xl shadow hover:shadow-md transition"
            >
              New member joined: <b>Riya Sharma</b>
            </li>
            <li
              class="bg-white p-4 rounded-xl shadow hover:shadow-md transition"
            >
              Donation received: <b>â‚¹500</b> from <b>Neha</b>
            </li>
          </ul>
        </div>
      </section>
    </main>


<!-- JavaScript for switching sections -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  // -----------------------------
  // Sidebar Navigation
  // -----------------------------
  const sidebarItems = document.querySelectorAll(".sidebar-item");
  const contentSections = document.querySelectorAll(".content-section");

  sidebarItems.forEach((item) => {
    item.addEventListener("click", () => {
      // Remove highlight from all sidebar items
      sidebarItems.forEach(el => el.classList.remove("bg-pink-100","font-semibold"));
      // Highlight the clicked sidebar item
      item.classList.add("bg-pink-100","font-semibold");

      // Hide all content sections
      contentSections.forEach(section => section.classList.add("hidden"));
      // Show the selected section
      const sectionId = item.getAttribute("data-section");
      document.getElementById(sectionId).classList.remove("hidden");
    });
  });

  // -----------------------------
  // Logout Button
  // -----------------------------
  const logoutBtn = document.querySelector("button.bg-pink-600");
  logoutBtn.addEventListener("click", () => {
    // Redirect to login page
    window.location.href = "../index.html";
  });
});
</script>

<!-- Event Management -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const eventTableBody = document.getElementById("eventTableBody");
  const eventForm = document.getElementById("eventForm");
  const imagePreview = document.getElementById("imagePreview");

  // -----------------------------
  // Load all events from backend
  // -----------------------------
  async function loadEvents() {
    try {
      const response = await fetch("http://127.0.0.1:5000/api/events");
      const result = await response.json();
      eventTableBody.innerHTML = ""; // Clear existing rows

      // Loop through each event and create table rows
      result.events.forEach(event => {
        const row = document.createElement("tr");
        row.classList.add("hover:bg-gray-50");
        row.innerHTML = `
          <td class="p-4">${event.name || "N/A"}</td>
          <td class="p-4">${event.status || "N/A"}</td>
          <td class="p-4">${event.date || "N/A"}</td>
          <td class="p-4">${event.location || "N/A"}</td>
          <td class="p-4">
            <button class="text-red-600 font-medium delete-btn" data-id="${event.id}">Delete</button>
          </td>
        `;
        eventTableBody.appendChild(row);

        // -----------------------------
        // Delete individual event
        // -----------------------------
        row.querySelector(".delete-btn").addEventListener("click", async () => {
          if (confirm(`Delete event "${event.name}"?`)) {
            await fetch(`http://127.0.0.1:5000/api/events/${event.id}`, { method: 'DELETE' });
            loadEvents(); // Reload table after deletion
          }
        });
      });

    } catch (err) {
      console.error("Error loading events:", err);
    }
  }

  // Initial load of events
  loadEvents();

  // -----------------------------
  // Image Preview before upload
  // -----------------------------
  document.getElementById("eventImages").addEventListener("change", (e) => {
    imagePreview.innerHTML = ""; // Clear previous previews
    [...e.target.files].forEach(file => {
      const reader = new FileReader();
      reader.onload = ev => {
        const img = document.createElement("img");
        img.src = ev.target.result;
        img.classList.add("w-20", "h-20", "object-cover", "rounded-lg", "shadow");
        imagePreview.appendChild(img);
      };
      reader.readAsDataURL(file);
    });
  });

  // -----------------------------
  // Submit new event
  // -----------------------------
  eventForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const submitBtn = eventForm.querySelector("button[type='submit']");
    submitBtn.disabled = true;
    submitBtn.textContent = "Submitting...";

    // Create FormData for sending form fields + images
    const formData = new FormData();
    formData.append("name", document.getElementById("eventName").value);
    formData.append("description", document.getElementById("eventDesc").value);
    formData.append("status", document.getElementById("eventStatus").value);
    formData.append("date", document.getElementById("eventDate").value);
    formData.append("location", document.getElementById("eventLocation").value);

    // Append all selected images
    const files = document.getElementById("eventImages").files;
    for (let i = 0; i < files.length; i++) {
      formData.append("image", files[i]); // Match Flask backend
    }

    try {
      const response = await fetch("http://127.0.0.1:5000/api/events", {
        method: "POST",
        body: formData // Content-Type auto-handled by browser
      });

      const result = await response.json();
      if (!response.ok) throw new Error(result.error || "Something went wrong");

      alert("Event added successfully!");
      eventForm.reset();
      imagePreview.innerHTML = "";

      // Reload event table
      loadEvents();
    } catch (err) {
      alert("Error: " + err.message);
      console.error(err);
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = "Add Event";
    }
  });
});
</script>

<!-- Donation Management -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const donationTableBody = document.getElementById("donationTableBody");
  const clearAllBtn = document.getElementById("clearAllBtn");

  // -----------------------------
  // Load all donations
  // -----------------------------
  async function loadDonations() {
    try {
      const response = await fetch("http://127.0.0.1:5000/api/donations");
      const result = await response.json();
      const donations = result.donations || [];
      donationTableBody.innerHTML = "";

      donations.forEach(donation => {
        const row = document.createElement("tr");
        row.classList.add("border-t", "hover:bg-gray-50");
        row.innerHTML = `
          <td class="p-3">${donation.Name}</td>
          <td class="p-3">${donation.Email}</td>
          <td class="p-3">${donation.Phone}</td>
          <td class="p-3">â‚¹${donation.Amount}</td>
          <td class="p-3">
            <a href="uploads/${donation.Screenshot}" target="_blank" class="text-pink-600 underline">View</a>
          </td>
          <td class="p-3">${donation.Timestamp}</td>
          <td class="p-3">
            <button class="text-red-600 font-medium delete-btn" data-timestamp="${donation.Timestamp}">Delete</button>
          </td>
        `;
        donationTableBody.appendChild(row);

        // Delete individual donation
        row.querySelector(".delete-btn").addEventListener("click", async () => {
          const timestamp = donation.Timestamp;
          if (confirm(`Delete donation by "${donation.Name}"?`)) {
            await fetch(`http://127.0.0.1:5000/api/donations/${timestamp}`, { method: "DELETE" });
            loadDonations();
          }
        });
      });
    } catch (err) {
      console.error("Error loading donations:", err);
    }
  }

  // Clear all donations
  clearAllBtn.addEventListener("click", async () => {
    if (confirm("Are you sure you want to delete ALL donations?")) {
      await fetch("http://127.0.0.1:5000/api/donations/clear", { method: "DELETE" });
      loadDonations();
    }
  });

  // Initial load
  loadDonations();
});
</script>

<!-- JoinUs Member Management -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const pendingList = document.getElementById("pendingList");
  const memberTableBody = document.getElementById("memberTableBody");
  const clearAllBtn = document.getElementById("clearAllMembers");

  // -----------------------------
  // Load all members and pending requests
  // -----------------------------
  async function loadMembers() {
    try {
      const response = await fetch("http://127.0.0.1:5000/api/joinus");
      const data = await response.json();
      const members = data.members || [];

      // Clear previous content
      pendingList.innerHTML = "";
      memberTableBody.innerHTML = "";

      members.forEach(member => {
        // Pending requests list
        if(member.Status === "Pending") {
          const li = document.createElement("li");
          li.classList.add("flex","justify-between","items-center","border-b","pb-3","hover:bg-gray-50","px-2");
          li.innerHTML = `
            <span>${member.Name} - ${member.Email} - ${member.Phone}</span>
            <div>
              <button class="text-green-600 mr-2 font-medium approve-btn">Approve</button>
              <button class="text-red-600 font-medium reject-btn">Reject</button>
              <button class="text-gray-600 font-medium delete-btn">Delete</button>
            </div>
          `;
          pendingList.appendChild(li);

          // Approve member
          li.querySelector(".approve-btn").addEventListener("click", async () => {
            try {
              await fetch(`http://127.0.0.1:5000/api/joinus/${member.Timestamp}/approve`, { method: "PUT" });
              loadMembers();
            } catch (err) {
              console.error(err);
              alert("Error approving member");
            }
          });

          // Reject member
          li.querySelector(".reject-btn").addEventListener("click", async () => {
            try {
              await fetch(`http://127.0.0.1:5000/api/joinus/${member.Timestamp}/reject`, { method: "PUT" });
              loadMembers();
            } catch (err) {
              console.error(err);
              alert("Error rejecting member");
            }
          });

          // Delete member
          li.querySelector(".delete-btn").addEventListener("click", async () => {
            if(confirm(`Delete member "${member.Name}"?`)) {
              try {
                await fetch(`http://127.0.0.1:5000/api/joinus/${member.Timestamp}`, { method: "DELETE" });
                loadMembers();
              } catch (err) {
                console.error(err);
                alert("Error deleting member");
              }
            }
          });
        }

        // Table of all members
        const row = document.createElement("tr");
        row.classList.add("hover:bg-gray-50");
        row.innerHTML = `
          <td class="p-3">${member.Name}</td>
          <td class="p-3">${member.Email}</td>
          <td class="p-3">${member.Phone}</td>
          <td class="p-3"><b>${member.Status}</b></td>
          <td class="p-3">${member.Timestamp}</td>
          <td class="p-3">
            ${member.Status === "Pending" ? `
              <button class="text-green-600 mr-2 font-medium approve-btn">Approve</button>
              <button class="text-red-600 font-medium reject-btn">Reject</button>` : ""}
            <button class="text-gray-600 font-medium delete-btn">Delete</button>
          </td>
        `;
        memberTableBody.appendChild(row);

        // Table buttons (approve/reject/delete)
        row.querySelectorAll(".approve-btn").forEach(btn => {
          btn.addEventListener("click", async () => {
            try {
              await fetch(`http://127.0.0.1:5000/api/joinus/${member.Timestamp}/approve`, { method: "PUT" });
              loadMembers();
            } catch (err) {
              console.error(err);
              alert("Error approving member");
            }
          });
        });

        row.querySelectorAll(".reject-btn").forEach(btn => {
          btn.addEventListener("click", async () => {
            try {
              await fetch(`http://127.0.0.1:5000/api/joinus/${member.Timestamp}/reject`, { method: "PUT" });
              loadMembers();
            } catch (err) {
              console.error(err);
              alert("Error rejecting member");
            }
          });
        });

        row.querySelectorAll(".delete-btn").forEach(btn => {
          btn.addEventListener("click", async () => {
            if(confirm(`Delete member "${member.Name}"?`)) {
              try {
                await fetch(`http://127.0.0.1:5000/api/joinus/${member.Timestamp}`, { method: "DELETE" });
                loadMembers();
              } catch (err) {
                console.error(err);
                alert("Error deleting member");
              }
            }
          });
        });
      });
    } catch(err) {
      console.error("Error loading members:", err);
    }
  }

  // -----------------------------
  // Clear all members
  // -----------------------------
  clearAllBtn.addEventListener("click", async () => {
    if(confirm("Are you sure you want to clear all members?")) {
      try {
        await fetch("http://127.0.0.1:5000/api/joinus/clear", { method: "DELETE" });
        loadMembers();
      } catch (err) {
        console.error(err);
        alert("Error clearing members");
      }
    }
  });

  // Initial load of members
  loadMembers();
});
</script>
 </body> 
</html>
